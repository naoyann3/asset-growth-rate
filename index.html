<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>主要資産 円建てパフォーマンス（デザイン調整版）</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #f8fafc; color: #0f172a; }
  .card { background: white; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); padding: 24px; border: 1px solid #f1f5f9; }
  
  .ranking-scroll::-webkit-scrollbar { width: 4px; }
  .ranking-scroll::-webkit-scrollbar-track { background: transparent; }
  .ranking-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }

  .asset-checkbox:checked + div { background-color: #f1f5f9; border-color: currentColor; box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); }
  
  .period-btn { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
  .period-btn.active { background-color: #0f172a; color: white; border-color: #0f172a; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(15, 23, 42, 0.3); }
  .period-btn:not(.active):hover { background-color: #e2e8f0; transform: translateY(-1px); }

  .ranking-item { transition: transform 0.2s ease, background-color 0.2s; cursor: pointer; border-left: 4px solid transparent; }
  .ranking-item:hover { transform: translateX(4px); background-color: #f8fafc; }
  .ranking-item.active-highlight { background-color: #f1f5f9; transform: translateX(6px); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
</style>
</head>
<body class="p-4 md:p-8 max-w-[1600px] mx-auto bg-slate-50">

  <header class="mb-8 text-center md:text-left md:flex md:justify-between md:items-end border-b border-slate-200 pb-6">
    <div>
      <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 tracking-tight mb-3">
        Market Performance
      </h1>
      <p class="text-slate-500 font-medium flex items-center justify-center md:justify-start gap-2 text-sm md:text-base">
        <span class="bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded text-xs font-bold">JPY BASIS</span>
        <span>2021.01 - 2025.11 (Split Adjusted)</span>
      </p>
    </div>
    <div class="mt-4 md:mt-0 text-right hidden md:block">
      <div class="text-[10px] text-slate-400 font-mono tracking-widest uppercase mb-1">Last Updated</div>
      <div class="text-xl font-bold text-slate-700 font-mono">2025.12.01</div>
    </div>
  </header>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-8">
    <div class="lg:col-span-12 card flex flex-wrap gap-2 sm:gap-4 justify-center md:justify-start items-center p-4">
      <span class="text-xs font-bold text-slate-400 mr-2 uppercase tracking-wider hidden sm:inline-block">Timeframe</span>
      <button class="period-btn active px-4 sm:px-6 py-2 rounded-full border border-slate-200 font-bold text-xs sm:text-sm" data-period="all">All Time</button>
      <button class="period-btn px-4 sm:px-6 py-2 rounded-full border border-slate-200 font-bold text-xs sm:text-sm" data-period="2021">2021~</button>
      <button class="period-btn px-4 sm:px-6 py-2 rounded-full border border-slate-200 font-bold text-xs sm:text-sm" data-period="2022">2022~</button>
      <button class="period-btn px-4 sm:px-6 py-2 rounded-full border border-slate-200 font-bold text-xs sm:text-sm" data-period="2023">2023~</button>
      <button class="period-btn px-4 sm:px-6 py-2 rounded-full border border-slate-200 font-bold text-xs sm:text-sm" data-period="2024">2024~</button>
      <button class="period-btn px-4 sm:px-6 py-2 rounded-full border border-slate-200 font-bold text-xs sm:text-sm" data-period="2025">2025~</button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <div class="lg:col-span-1 space-y-6 order-2 lg:order-1">
      <div class="card">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider">Assets</h3>
          <div class="flex gap-2">
            <button id="btn-select-all" class="text-[10px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded">All</button>
            <button id="btn-select-none" class="text-[10px] font-bold text-slate-400 hover:bg-slate-100 px-2 py-1 rounded">Clear</button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2" id="asset-toggles"></div>
      </div>

      <div class="card h-[500px] lg:h-[calc(100vh-450px)] min-h-[400px] flex flex-col">
        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 flex justify-between items-center">
          <span>Ranking</span>
          <span class="text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-500" id="ranking-period-label">All Time</span>
        </h3>
        <div class="flex-1 overflow-y-auto ranking-scroll pr-1 space-y-1" id="ranking-list"></div>
      </div>
    </div>

    <div class="lg:col-span-3 order-1 lg:order-2 space-y-6">
      <div class="card h-[400px] sm:h-[500px] md:h-[650px] relative p-2 sm:p-6">
        <canvas id="chart"></canvas>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="card bg-gradient-to-br from-indigo-50 to-white border border-indigo-100 flex flex-col justify-center py-4">
          <div class="text-[10px] text-indigo-400 font-bold uppercase mb-1 tracking-wider">Top Performer</div>
          <div class="flex items-baseline gap-2">
            <div class="text-xl md:text-2xl font-black text-indigo-900 truncate" id="summary-best-name">-</div>
            <div class="text-sm font-bold text-indigo-600" id="summary-best-val">-</div>
          </div>
        </div>
        <div class="card bg-white border border-slate-100 flex flex-col justify-center py-4">
          <div class="text-[10px] text-slate-400 font-bold uppercase mb-1 tracking-wider">Selection Average</div>
          <div class="text-xl md:text-2xl font-black text-slate-700" id="summary-avg">-</div>
        </div>
        <div class="card bg-white border border-slate-100 flex flex-col justify-center py-4">
          <div class="text-[10px] text-slate-400 font-bold uppercase mb-1 tracking-wider">Worst Performer</div>
          <div class="flex items-baseline gap-2">
             <div class="text-xl md:text-2xl font-black text-slate-700 truncate" id="summary-worst-name">-</div>
             <div class="text-sm font-bold text-slate-500" id="summary-worst-val">-</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
// ==========================================
//  DATA DEFINITIONS (2021/01 - 2025/11)
// ==========================================

const rawPrices_USD = {
  NVIDIA: [12.99,13.71,13.35,15.01,16.24,20.00,19.49,22.38,20.72,25.57,32.68,29.41,24.49,24.39,27.29,18.55,18.76,15.16,18.16,15.09,12.14,13.50,16.92,14.61,19.54,23.22,27.78,27.75,37.83,42.30,46.73,49.35,43.50,40.78,46.77,49.52,61.53,79.11,90.36,86.40,109.63,123.54,117.02,119.37,121.44,132.76,138.25,134.29,120.07,124.92,108.38,108.92,135.13,157.99,177.87,174.18,186.58,202.49,177.00],
  GOOGLE: [91.37,101.10,103.13,117.68,117.84,122.09,134.73,144.70,133.68,148.05,141.90,144.85,135.30,135.06,139.07,114.11,114.33,108.96,116.32,108.22,95.65,94.51,100.99,88.23,98.84,90.06,103.73,107.34,122.87,119.70,132.72,136.17,130.86,124.08,132.53,139.69,140.10,138.46,150.93,162.78,172.50,182.15,171.54,163.38,165.85,171.11,168.95,189.30,204.02,170.28,154.64,158.80,171.74,176.23,191.90,212.91,243.10,281.19,320.18],
  AAPL: [131.96,121.26,122.15,131.46,124.61,136.96,145.86,151.83,141.50,149.80,165.30,177.57,174.78,165.12,174.61,157.65,149.30,136.72,162.51,157.22,138.20,153.34,148.03,129.93,144.29,147.41,164.90,169.68,177.25,193.97,196.45,187.87,171.21,170.77,189.95,192.53,184.40,180.75,171.48,170.33,192.25,210.62,222.08,229.00,233.00,225.91,237.33,250.42,236.00,241.84,222.13,212.50,200.85,205.17,207.57,232.14,254.63,270.37,278.85],
  BTC: [33108,45164,58763,57720,37298,35026,41553,47130,43823,61309,56882,46219,38498,43188,45525,37650,31793,19926,23303,20043,19423,20496,17163,16537,23125,23130,28473,29252,27216,30472,29232,25937,26962,34650,37712,42272,42580,61169,71332,60666,67530,62754,64626,58978,63339,70281,96405,93557,94536,84381,82548,94184,104598,107171,115765,108226,114048,109602,90374],
  ETH: [1312,1418,1917,2772,2708,2273,2532,3430,3000,4287,4628,3677,2686,2922,3282,2727,1941,1069,1680,1555,1328,1572,1294,1195,1585,1604,1821,1868,1873,1933,1856,1645,1670,1815,2051,2281,2283,3339,3647,3014,3762,3437,3231,2513,2603,2519,3702,3337,3298,2236,1821,1793,2528,2486,3698,4391,4144,3848,2991],
  BNB: [44.27,210.04,302.18,623.33,353.74,303.25,332.41,464.29,387.59,524.46,623.23,511.70,374.21,395.61,428.84,377.01,320.79,219.39,283.50,279.11,284.89,325.79,300.40,246.10,312.11,301.39,317.10,337.58,306.70,240.40,240.90,216.70,214.50,226.30,227.60,312.00,300.50,399.10,606.89,578.41,593.80,582.30,576.40,532.90,567.51,576.60,653.72,702.39,677.48,587.97,604.80,599.71,657.90,656.90,783.20,857.60,1008.60,1088.71,875.50]
};

const rawPrices_JPY = {
  NIKKEI: [27663,28966,29178,28812,28860,28791,27283,28089,29452,28892,27821,28791,27001,26526,27821,26847,27279,26393,27801,28091,25937,27587,27968,26094,27327,27445,28041,28856,30887,33189,33172,32619,31857,30858,33486,33464,36286,39166,40369,38405,38487,39583,39101,38647,37919,39081,38208,39894,39572,37155,35617,36045,37965,40487,41069,42718,44932,52411,50254],
  SP500: [13641,14043,15142,15861,15975,16444,16777,17277,16951,18163,18432,19204,17837,17684,19683,18851,18669,18301,19236,19417,18548,20365,19380,18035,18524,19213,19167,19670,20875,22664,22984,23519,22940,22238,23926,24281,26026,27391,28559,28832,29510,31789,29851,29198,29562,32262,32695,34182,33955,31801,30280,28788,30919,32527,34608,34812,36175,38371,38984],
  GOLD: [6276,6199,6066,6195,6549,6554,6450,6369,6368,6495,6728,6580,6755,6913,7464,7901,7695,7954,7699,7721,7794,7920,7944,7854,8024,7990,8249,8620,8822,8871,8879,8988,9155,9246,9604,9486,9622,9779,10428,11561,11880,11859,12185,11675,11863,12978,13155,13082,13676,14169,14298,14996,15349,15638,15832,16020,17429,19828,20454],
  SILVER: [88.8,96.0,93.0,93.0,100.1,99.0,94.8,88.2,86.3,87.7,92.0,84.8,88.7,89.7,99.1,102.9,93.4,95.6,86.6,89.0,89.4,93.7,98.2,103.3,101.8,96.6,96.4,109.3,108.9,108.7,111.2,112.2,113.1,110.3,115.8,114.7,110.9,112.0,120.2,137.8,151.3,153.2,154.5,137.9,141.0,158.9,156.5,154.1,156.2,160.3,162.1,153.4,156.3,169.8,180.6,183.7,204.6,243.2,256.6]
};

const usdjpy = [104.73,106.57,110.73,109.32,109.60,111.10,109.68,109.99,111.26,114.00,113.01,115.07,115.08,114.95,121.69,130.84,128.70,135.76,133.23,138.95,144.75,148.74,137.97,131.20,130.14,136.18,132.82,136.30,139.33,144.32,142.25,145.53,149.34,151.70,148.26,141.04,147.24,149.92,151.34,157.72,157.28,160.89,149.88,146.17,143.59,152.08,149.77,157.20,155.20,150.62,149.91,142.96,144.04,144.03,150.71,147.86,147.86,153.99,156.18];

const db = {};
for (const key in rawPrices_USD) {
  db[key] = rawPrices_USD[key].map((p, i) => Math.round(p * usdjpy[i]));
}
for (const key in rawPrices_JPY) {
  db[key] = rawPrices_JPY[key];
}

const meta = {
  NVIDIA: { label:'NVIDIA', color:'#76B900', type:'stock' },
  GOOGLE: { label:'Google', color:'#4285F4', type:'stock' },
  AAPL:   { label:'Apple',  color:'#A2A2A2', type:'stock' },
  NIKKEI: { label:'日経平均', color:'#DC2626', type:'index' },
  SP500:  { label:'S&P 500',color:'#3B82F6', type:'index' },
  GOLD:   { label:'Gold',   color:'#D4AF37', type:'commodity' },
  SILVER: { label:'Silver', color:'#94A3B8', type:'commodity' },
  BTC:    { label:'Bitcoin',color:'#F7931A', type:'crypto' },
  ETH:    { label:'Ethereum',color:'#627EEA', type:'crypto' },
  BNB:    { label:'BNB',    color:'#F3BA2F', type:'crypto' }
};

const labels = [];
let startY = 2021, startM = 1;
for (let i = 0; i < 59; i++) {
  labels.push(`${startY}/${String(startM).padStart(2,'0')}`);
  startM++;
  if (startM > 12) { startM = 1; startY++; }
}

let myChart = null;
let currentPeriod = 'all';
let activeKeys = Object.keys(db);
let selectedAssetKey = null;

function init() {
  createAssetToggles();
  setupEventListeners();
  renderChart();
  updateDashboard();
}

function createAssetToggles() {
  const container = document.getElementById('asset-toggles');
  Object.keys(meta).forEach(key => {
    const m = meta[key];
    const div = document.createElement('div');
    div.innerHTML = `
      <label class="cursor-pointer group block">
        <input type="checkbox" class="asset-checkbox hidden" value="${key}" checked>
        <div class="flex items-center p-2 rounded-lg border border-transparent transition-all hover:bg-white hover:shadow-sm" style="color:${m.color}">
          <span class="w-3 h-3 rounded-full mr-2" style="background-color:${m.color}"></span>
          <span class="font-bold text-sm text-slate-700 group-hover:text-slate-900">${m.label}</span>
        </div>
      </label>
    `;
    container.appendChild(div);
  });
}

function setupEventListeners() {
  document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      currentPeriod = e.target.dataset.period;
      updateDashboard();
    });
  });

  document.querySelectorAll('.asset-checkbox').forEach(cb => {
    cb.addEventListener('change', () => {
      activeKeys = Array.from(document.querySelectorAll('.asset-checkbox:checked')).map(c => c.value);
      if (selectedAssetKey && !activeKeys.includes(selectedAssetKey)) {
        selectedAssetKey = null;
      }
      updateDashboard();
    });
  });

  document.getElementById('btn-select-all').addEventListener('click', () => {
    document.querySelectorAll('.asset-checkbox').forEach(c => c.checked = true);
    activeKeys = Object.keys(db);
    updateDashboard();
  });
  document.getElementById('btn-select-none').addEventListener('click', () => {
    document.querySelectorAll('.asset-checkbox').forEach(c => c.checked = false);
    activeKeys = [];
    selectedAssetKey = null;
    updateDashboard();
  });
  
  document.getElementById('chart').addEventListener('mouseleave', () => {
    // 選択状態がなければリセット、あれば何もしない（選択維持）
    if(!selectedAssetKey) updateDashboard(); 
  });
}

function getStartIndex() {
  if (currentPeriod === 'all') return 0;
  const target = `${currentPeriod}/01`;
  return labels.indexOf(target);
}

function updateDashboard() {
  const startIdx = getStartIndex();
  const slicedLabels = labels.slice(startIdx);
  
  const datasets = activeKeys.map(key => {
    const rawData = db[key].slice(startIdx);
    const baseValue = rawData[0];
    const percentageData = rawData.map(v => baseValue ? ((v - baseValue) / baseValue) * 100 : 0);
    
    const isSelected = selectedAssetKey === key;
    const isDimmed = selectedAssetKey !== null && !isSelected;

    return {
      label: meta[key].label,
      data: percentageData,
      rawValues: rawData,
      borderColor: isDimmed ? '#e2e8f0' : meta[key].color,
      backgroundColor: meta[key].color,
      borderWidth: isSelected ? 4 : (isDimmed ? 1 : 2),
      pointRadius: 0,
      tension: 0.1,
      assetKey: key,
      order: isSelected ? -1 : (isDimmed ? 1 : 0)
    };
  });

  myChart.data.labels = slicedLabels;
  myChart.data.datasets = datasets;
  myChart.update();

  updateRankingAndSummary(activeKeys, startIdx);
  document.getElementById('ranking-period-label').textContent = document.querySelector('.period-btn.active').textContent;
}

function updateRankingAndSummary(keys, startIdx) {
  const rankingList = document.getElementById('ranking-list');
  rankingList.innerHTML = '';

  if (keys.length === 0) {
    document.getElementById('summary-best-name').textContent = '-';
    document.getElementById('summary-best-val').textContent = '-';
    document.getElementById('summary-avg').textContent = '-';
    document.getElementById('summary-worst-name').textContent = '-';
    document.getElementById('summary-worst-val').textContent = '-';
    return;
  }

  const performance = keys.map(key => {
    const data = db[key];
    const startVal = data[startIdx];
    const endVal = data[data.length - 1];
    const change = startVal ? ((endVal - startVal) / startVal) * 100 : 0;
    return { key, change, endVal, label: meta[key].label, color: meta[key].color };
  }).sort((a, b) => b.change - a.change);

  performance.forEach((item, index) => {
    const el = document.createElement('div');
    el.className = `ranking-item p-3 rounded-lg flex items-center justify-between mb-1 ${item.key === selectedAssetKey ? 'active-highlight' : ''}`;
    el.style.borderLeftColor = item.key === selectedAssetKey ? item.color : 'transparent';
    el.innerHTML = `
      <div class="flex items-center space-x-3">
        <span class="font-black text-slate-300 w-4 text-center">${index + 1}</span>
        <span class="font-bold text-sm text-slate-700" style="color:${item.color}">${item.label}</span>
      </div>
      <div class="text-right">
        <div class="font-black text-sm ${item.change > 0 ? 'text-emerald-500' : 'text-rose-500'}">
          ${item.change > 0 ? '+' : ''}${item.change.toFixed(1)}%
        </div>
        <div class="text-[10px] text-slate-400">¥${item.endVal.toLocaleString()}</div>
      </div>
    `;
    el.addEventListener('click', () => toggleAssetSelection(item.key));
    rankingList.appendChild(el);
  });

  const best = performance[0];
  const worst = performance[performance.length - 1];
  const avg = performance.reduce((sum, p) => sum + p.change, 0) / performance.length;

  document.getElementById('summary-best-name').textContent = best.label;
  document.getElementById('summary-best-name').style.color = best.color;
  document.getElementById('summary-best-val').textContent = `+${best.change.toFixed(1)}%`;
  
  document.getElementById('summary-worst-name').textContent = worst.label;
  document.getElementById('summary-worst-name').style.color = worst.color;
  document.getElementById('summary-worst-val').textContent = `${worst.change.toFixed(1)}%`;

  document.getElementById('summary-avg').textContent = `${avg > 0 ? '+' : ''}${avg.toFixed(1)}%`;
}

function toggleAssetSelection(key) {
  if (selectedAssetKey === key) {
    selectedAssetKey = null;
  } else {
    selectedAssetKey = key;
  }
  updateDashboard();
}

function renderChart() {
  const ctx = document.getElementById('chart').getContext('2d');
  Chart.defaults.font.family = "'Inter', sans-serif";
  Chart.register(ChartDataLabels);

  myChart = new Chart(ctx, {
    type: 'line',
    data: { labels: [], datasets: [] },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      hover: { mode: null }, 
      interaction: {
        mode: 'nearest',
        axis: 'x',
        intersect: false
      },
      onClick: (e, activeElements, chart) => {
        if (activeElements.length > 0) {
          const index = activeElements[0].datasetIndex;
          const key = chart.data.datasets[index].assetKey;
          toggleAssetSelection(key);
        } else {
          selectedAssetKey = null;
          updateDashboard();
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(255, 255, 255, 0.95)',
          titleColor: '#1e293b',
          bodyColor: '#334155',
          borderColor: '#e2e8f0',
          borderWidth: 1,
          padding: 10,
          titleFont: { weight: 'bold' },
          itemSort: function(a, b) { return b.raw - a.raw; },
          callbacks: {
            label: function(context) {
              const label = context.dataset.label || '';
              const val = context.parsed.y;
              const raw = context.dataset.rawValues[context.dataIndex];
              return `${label}: ${val > 0 ? '+' : ''}${val.toFixed(1)}% (¥${raw.toLocaleString()})`;
            }
          }
        },
        datalabels: {
          align: 'right',
          anchor: 'end',
          offset: 0,
          backgroundColor: function(context) {
             if (selectedAssetKey !== null && context.dataset.assetKey !== selectedAssetKey) {
                 return '#f8fafc';
             }
             return 'white';
          },
          borderColor: function(context) {
             return context.dataset.borderColor;
          },
          // 名札のスタイル調整（大きく、余白を広く）
          borderWidth: 2,
          borderRadius: 6,
          color: function(context) {
            if (selectedAssetKey !== null && context.dataset.assetKey !== selectedAssetKey) {
                 return '#cbd5e1';
             }
             return context.dataset.borderColor;
          },
          font: { weight: 'bold', size: 12 }, // フォント拡大
          padding: { top: 6, bottom: 6, left: 10, right: 10 }, // 余白拡大
          formatter: function(value, context) {
            if (context.dataIndex === context.dataset.data.length - 1) {
              return context.dataset.label;
            }
            return null;
          },
          display: 'auto'
        }
      },
      layout: {
        // 名札用スペースを確保
        padding: { right: 120 } 
      },
      scales: {
        x: {
          grid: { 
            display: true, // グリッド表示ON
            color: '#e2e8f0',
            drawBorder: false
          },
          ticks: { 
            maxTicksLimit: 12, 
            color: '#64748b', // ラベル色を濃く
            font: { size: 11, weight: '500' }
          }
        },
        y: {
          grid: { color: '#f1f5f9' },
          ticks: { 
            callback: function(value) { return value + '%'; },
            color: '#94a3b8'
          }
        }
      }
    }
  });
}

init();
</script>
</body>
</html>
